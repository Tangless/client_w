import * as tomato from "@po-to/tomato";
import * as project from "views/global/common/Project";
import * as funs from "views/global/common/Funs";
import * as tdom from "@po-to/tomato-jquery";
import * as model from "views/global/common/Model";

class VPresenter extends project.VPresenter {
    /**模块 */
    private AboutForm_vue: any;
    /**列表 */
    private _contentList: JQuery;
    /**列表本身高度 */
    private _height: any;
    private footer: tomato.VPresenter;

    constructor(view: tomato.VPView, parent?: tomato.VPresenter, vpid?: string) {
        super(view, parent, vpid);

        this._contentList = this.find(".content-list");
        this._height = this.find("[class^='list-']").height();
        var height = this._height;
        this._contentList.each(function (i, o) {
            var that = $(this);
            var currentHeight;
            var autoHeight;

            var list = that.find("[class^='list-']");
            that.find(".open").on("click", function () {
                //当前为收回状态，将执行展开动画
                autoHeight = list.css('height', 'auto').height();
                list.height(height).animate({ height: autoHeight },
                    500, function () {
                        that.find(".open").addClass("hide");
                        that.find(".call-back").removeClass("hide");
                        that.find(".cover").addClass("hide");
                        list.css('overflow', 'auto');
                    }
                );
            });
            that.find(".call-back").on("click", function () {
                //当前为展开状态，将执行收回动画
                currentHeight = list.height();
                that.find(".cover").removeClass("hide");
                list.height(currentHeight).animate({ height: height }, 500, function () {
                    that.find(".call-back").addClass("hide");
                    that.find(".open").removeClass("hide");
                    list.css('overflow', 'hidden');

                });

            });
        });
        this._watchEvent();
    }
    scrollTo(point) {
        var sh = $(point).offset().top;
        $(this.view).parent().scrollTop(sh);
    }
    /** */
    public init() {
        return tomato.getVPresenter<tomato.VPresenter>(funs.moduleToUrl('m/project/InquiryLayer'), (InquiryLayer) => { this.footer = InquiryLayer; })
    }
    public getFooter(){
        if(model.globalData.demand.id && model.globalData.demand.id != '0'){
            return null
        }else{
            return this.footer.view;
        }
    }
}
export = VPresenter;