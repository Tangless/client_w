import * as tomato from "@po-to/tomato";
import * as tdom from "@po-to/tomato-jquery";
import * as project from "views/global/common/Project";
import * as funs from "views/global/common/Funs";
import * as model from "views/global/common/Model";
import * as Hammer from 'hammer';
// import * as Vue from 'vue';
import ChatRoom  = require('views/m/ChatRoom');

class VPresenter extends project.VPresenter {
    private originData: any[];
    constructor(view: tomato.VPView, parent?: tomato.VPresenter, vpid?: string) {
        super(view, parent, vpid);
        this._watchEvent();
        this._els = this._getElements();
        //首页所有的项目信息数组
        var od = this._els['origin_data'][0]["text"];
        this.originData = JSON.parse(od);

        var carousel = this.find('.carousel');
        //滑动切换
        carousel.carousel({
            interval: false,
            wrap: false
        });
        var slider1 = this.find('.slider1')[0];
        var hamm1 = new Hammer(slider1);
        hamm1.on('swipeleft', function () {
            $(slider1).carousel('next');
        }).on('swiperight', function () {
            $(slider1).carousel('prev');
        });
        var slider2 = this.find('.slider2')[0];
        var hamm2 = new Hammer(slider2);
        hamm2.on('swipeleft', function () {
            $(slider2).carousel('next');
        }).on('swiperight', function () {
            $(slider2).carousel('prev');
        });
        var slider3 = this.find('.slider3')[0];
        var hamm3 = new Hammer(slider3);
        hamm3.on('swipeleft', function () {
            $(slider3).carousel('next');
        }).on('swiperight', function () {
            $(slider3).carousel('prev');
        });
        var slider4 = this.find('.slider4')[0];
        var hamm4 = new Hammer(slider4);
        hamm4.on('swipeleft', function () {
            $(slider4).carousel('next');
        }).on('swiperight', function () {
            $(slider4).carousel('prev');
        });
        var slider5 = this.find('.slider5')[0];
        var hamm5 = new Hammer(slider5);
        hamm5.on('swipeleft', function () {
            $(slider5).carousel('next');
        }).on('swiperight', function () {
            $(slider5).carousel('prev');
        });
    }
    //项目的点击事件
    _evt_openProDetail(data, target, hit) {
        var did = $(target).attr('did');
        var pro_info = this.getProjectData(did);
        //将临时数据更改为自己的项目的数据
        model.globalData.current_demand = pro_info;
        var flag = model.globalData.demand.id == model.globalData.current_demand.id;
        model.globalData.currIsSelfDemand = flag;
        tomato.getVPresenter<ChatRoom>(funs.moduleToUrl('m/ChatRoom'), (ChatRoom) => {
            //弹出详情页
            funs.loadPage(ChatRoom)
            ChatRoom.openChatRoom();
            ChatRoom.setBudget();
        })
    };
    //获取单个项目的详细信息
    getProjectData(did) {
        for (let a of this.originData) {
            if (a.id == did) {
                return a
            }
        }
    }

}
export = VPresenter;