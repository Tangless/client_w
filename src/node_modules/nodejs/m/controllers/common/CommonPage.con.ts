import * as potato from '@po-to/potato';

class Controller extends potato.Controller {
    Item(request: potato.Request, resolve: (data: Object | potato.ViewRendererData) => void, reject: (error: potato.PError) => void) {
        let core = request.root.core;
        let args = request.args || {};
        let insertHead: potato.Request = new potato.Request(request.root, 'm/common/InsertHead', 'Item', '', { title: "", keywords: "", description: ""});
        let insertFoot: potato.Request = new potato.Request(request.root, 'm/common/InsertFoot', 'Item', '', { mainJS: 'm/common/CommonPage' });
        let contentModPath:string = decodeURIComponent(args['__content__']||'');
        delete args['__content__'];
        let contentModRequest:potato.Request|null=null;
        if(contentModPath){
            let contentModReq = core.routing(contentModPath, 'GET', args);
            if(contentModReq){
                let{controller,action,path} = contentModReq;
                args['__request__'] = 'amd';
                contentModRequest = new potato.Request(request.root,controller,action,path,args);
            }
        }
        let content: string = contentModRequest ? contentModRequest.toUrl() : "";
        let data = { insertHead: insertHead, insertFoot: insertFoot, content: content };
        let template = new potato.View('m/common/CommonPageTpl');
        let result = new potato.ViewRendererData(template, data);
        resolve(result);
    }
}

let ins: Object = new Controller();
export = ins;